protocols {
    bgp {
        group INTERNALv6 {
            type internal;
            local-address 2001::1:1:0:2;
            family evpn {
                signaling {
                    advertise-srv6-service;
                    accept-srv6-service;
                }
            }
            neighbor 2001::1:1:0:1;
            neighbor 2001::1:1:0:3;
        }
    }
}
routing-options {
    router-id 1.1.0.2;
    autonomous-system 65100;
}
chassis {
    aggregated-devices {
        ethernet {
            device-count 64;
        }
    }
}
interfaces {
    lo0 {
        unit 0 {
            family inet {
                address 1.1.0.2/32 {
                    primary;
                }
            }
            family inet6 {
                address 2001::1:1:0:2/128 {
                    primary;
                }
            }
        }
    }
    ge-0/0/1 {
        gigether-options {
            802.3ad ae2;
        }
    }
    ae2 {
        mtu 9192;
        aggregated-ether-options {
            lacp {
                active;
                periodic fast;
                fast-failover;
            }
        }
        unit 0 {
            family iso;
        }
    }
    ge-0/0/0 {
        gigether-options {
            802.3ad ae3;
        }
    }
    ae3 {
        mtu 9192;
        aggregated-ether-options {
            lacp {
                active;
                periodic fast;
                fast-failover;
            }
        }
        unit 0 {
            family iso;
        }
    }
    ge-0/0/2 {
        gigether-options {
            802.3ad ae10;
        }
    }
    ae10 {
        flexible-vlan-tagging;
        mtu 9192;
        encapsulation flexible-ethernet-services;
        esi {
            00:01:02:00:00:00:00:00:10:00;
            all-active;
            df-election-type {
                preference {
                    value 100;
                }
            }
        }
        aggregated-ether-options {
            lacp {
                active;
                periodic fast;
                fast-failover;
                system-id 00:00:00:00:10:00;
                aggregate-wait-time 60;
            }
        }
    }
}
interfaces {
    ae2 {
        description to-p1:ae2;
        unit 0 {
            family inet6 {
                address 2001::10:100:0:4/127;
            }
        }
    }
}
interfaces {
    ae3 {
        description to-p2:ae3;
        unit 0 {
            family inet6 {
                address 2001::10:100:0:6/127;
            }
        }
    }
}
interfaces {
    ae10 {
        unit 200 {
            encapsulation vlan-bridge;
            vlan-id 200;
        }
    }
    ae10 {
        unit 201 {
            encapsulation vlan-bridge;
            vlan-id 201;
        }
    }
}
routing-instances {
    elan200 {
        instance-type mac-vrf;
        protocols {
            evpn {
                encapsulation srv6;
                source-packet-routing {
                    srv6 locator myloc2 micro-dt2-sid;
                }
            }
        }
        service-type vlan-based;
        interface ae10.200;
        route-distinguisher 1.1.0.2:200;
        vrf-target target:65100:200;
        bridge-domains {
            bd200 {
                vlan-id 200;
                interface ae10.200;
            }
        }
    }
    elan201 {
        instance-type mac-vrf;
        protocols {
            evpn {
                encapsulation srv6;
                source-packet-routing {
                    srv6 locator myloc2 micro-dt2-sid;
                }
            }
        }
        service-type vlan-based;
        interface ae10.201;
        route-distinguisher 1.1.0.2:201;
        vrf-target target:65100:201;
        bridge-domains {
            bd201 {
                vlan-id 201;
                interface ae10.201;
            }
        }
    }
}
protocols {
    bgp {
        group INTERNALv6 {
            type internal;
            local-address 2001::1:1:0:2;
            family evpn {
                signaling {
                    advertise-srv6-service;
                    accept-srv6-service;
                }
            }
            neighbor 2001::1:1:0:1;
            neighbor 2001::1:1:0:3;
        }
    }
}
routing-options {
    router-id 1.1.0.2;
    autonomous-system 65100;
}
chassis {
    aggregated-devices {
        ethernet {
            device-count 64;
        }
    }
}
interfaces {
    lo0 {
        unit 0 {
            family inet {
                address 1.1.0.2/32 {
                    primary;
                }
            }
            family inet6 {
                address 2001::1:1:0:2/128 {
                    primary;
                }
            }
        }
    }
    ge-0/0/1 {
        gigether-options {
            802.3ad ae2;
        }
    }
    ae2 {
        mtu 9192;
        aggregated-ether-options {
            lacp {
                active;
                periodic fast;
                fast-failover;
            }
        }
        unit 0 {
            family iso;
        }
    }
    ge-0/0/0 {
        gigether-options {
            802.3ad ae3;
        }
    }
    ae3 {
        mtu 9192;
        aggregated-ether-options {
            lacp {
                active;
                periodic fast;
                fast-failover;
            }
        }
        unit 0 {
            family iso;
        }
    }
    ge-0/0/2 {
        gigether-options {
            802.3ad ae10;
        }
    }
    ae10 {
        flexible-vlan-tagging;
        mtu 9192;
        encapsulation flexible-ethernet-services;
        esi {
            00:01:02:00:00:00:00:00:10:00;
            all-active;
            df-election-type {
                preference {
                    value 100;
                }
            }
        }
        aggregated-ether-options {
            lacp {
                active;
                periodic fast;
                fast-failover;
                system-id 00:00:00:00:10:00;
                aggregate-wait-time 60;
            }
        }
    }
}
interfaces {
    ae2 {
        description to-p1:ae2;
        unit 0 {
            family inet6 {
                address 2001::10:100:0:4/127;
            }
        }
    }
}
interfaces {
    ae3 {
        description to-p2:ae3;
        unit 0 {
            family inet6 {
                address 2001::10:100:0:6/127;
            }
        }
    }
}
interfaces {
    ae10 {
        unit 200 {
            encapsulation vlan-bridge;
            vlan-id 200;
        }
    }
    ae10 {
        unit 201 {
            encapsulation vlan-bridge;
            vlan-id 201;
        }
    }
}
routing-instances {
    elan200 {
        instance-type mac-vrf;
        protocols {
            evpn {
                encapsulation srv6;
                source-packet-routing {
                    srv6 locator myloc2 micro-dt2-sid;
                }
            }
        }
        service-type vlan-based;
        interface ae10.200;
        route-distinguisher 1.1.0.2:200;
        vrf-target target:65100:200;
        bridge-domains {
            bd200 {
                vlan-id 200;
                interface ae10.200;
            }
        }
    }
    elan201 {
        instance-type mac-vrf;
        protocols {
            evpn {
                encapsulation srv6;
                source-packet-routing {
                    srv6 locator myloc2 micro-dt2-sid;
                }
            }
        }
        service-type vlan-based;
        interface ae10.201;
        route-distinguisher 1.1.0.2:201;
        vrf-target target:65100:201;
        bridge-domains {
            bd201 {
                vlan-id 201;
                interface ae10.201;
            }
        }
    }
}
protocols {
    bgp {
        group INTERNALv6 {
            type internal;
            local-address 2001::1:1:0:2;
            family evpn {
                signaling {
                    advertise-srv6-service;
                    accept-srv6-service;
                }
            }
            neighbor 2001::1:1:0:1;
            neighbor 2001::1:1:0:3;
        }
    }
}
routing-options {
    router-id 1.1.0.2;
    autonomous-system 65100;
}
chassis {
    aggregated-devices {
        ethernet {
            device-count 64;
        }
    }
}
interfaces {
    lo0 {
        unit 0 {
            family inet {
                address 1.1.0.2/32 {
                    primary;
                }
            }
            family inet6 {
                address 2001::1:1:0:2/128 {
                    primary;
                }
            }
        }
    }
    ge-0/0/1 {
        gigether-options {
            802.3ad ae2;
        }
    }
    ae2 {
        mtu 9192;
        aggregated-ether-options {
            lacp {
                active;
                periodic fast;
                fast-failover;
            }
        }
        unit 0 {
            family iso;
        }
    }
    ge-0/0/0 {
        gigether-options {
            802.3ad ae3;
        }
    }
    ae3 {
        mtu 9192;
        aggregated-ether-options {
            lacp {
                active;
                periodic fast;
                fast-failover;
            }
        }
        unit 0 {
            family iso;
        }
    }
    ge-0/0/2 {
        gigether-options {
            802.3ad ae10;
        }
    }
    ae10 {
        flexible-vlan-tagging;
        mtu 9192;
        encapsulation flexible-ethernet-services;
        esi {
            00:01:02:00:00:00:00:00:10:00;
            all-active;
            df-election-type {
                preference {
                    value 100;
                }
            }
        }
        aggregated-ether-options {
            lacp {
                active;
                periodic fast;
                fast-failover;
                system-id 00:00:00:00:10:00;
                aggregate-wait-time 60;
            }
        }
    }
}
interfaces {
    ae2 {
        description to-p1:ae2;
        unit 0 {
            family inet6 {
                address 2001::10:100:0:4/127;
            }
        }
    }
}
interfaces {
    ae3 {
        description to-p2:ae3;
        unit 0 {
            family inet6 {
                address 2001::10:100:0:6/127;
            }
        }
    }
}
interfaces {
    ae10 {
        unit 200 {
            encapsulation vlan-bridge;
            vlan-id 200;
        }
    }
    ae10 {
        unit 201 {
            encapsulation vlan-bridge;
            vlan-id 201;
        }
    }
}
routing-instances {
    elan200 {
        instance-type mac-vrf;
        protocols {
            evpn {
                encapsulation srv6;
                source-packet-routing {
                    srv6 locator myloc2 micro-dt2-sid;
                }
            }
        }
        service-type vlan-based;
        interface ae10.200;
        route-distinguisher 1.1.0.2:200;
        vrf-target target:65100:200;
        bridge-domains {
            bd200 {
                vlan-id 200;
                interface ae10.200;
            }
        }
    }
    elan201 {
        instance-type mac-vrf;
        protocols {
            evpn {
                encapsulation srv6;
                source-packet-routing {
                    srv6 locator myloc2 micro-dt2-sid;
                }
            }
        }
        service-type vlan-based;
        interface ae10.201;
        route-distinguisher 1.1.0.2:201;
        vrf-target target:65100:201;
        bridge-domains {
            bd201 {
                vlan-id 201;
                interface ae10.201;
            }
        }
    }
}
interfaces {
    lo0 {
        unit 0 {
            family iso {
                address 49.2001.0000.0101.0002.00;
            }
        }
    }
}
protocols {
    isis {
        interface ae2.0 {
            level 2 {
                post-convergence-lfa;
            }
            point-to-point;
        }
        interface ae3.0 {
            level 2 {
                post-convergence-lfa;
            }
            point-to-point;
        }
        interface lo0.0 {
            passive;
        }
        source-packet-routing {
            srv6 {
                locator myloc1 {
                    end-sid 1111:1111:2222::;
                }
                locator myloc2 {
                }
            }
        }
        level 1 disable;
        level 2 wide-metrics-only;
        backup-spf-options {
            use-post-convergence-lfa maximum-backup-paths 8;
            use-source-packet-routing;
        }
        traffic-engineering {
            l3-unicast-topology;
            advertisement always;
        }
    }
}
routing-options {
    source-packet-routing {
        srv6 {
            locator myloc1 {
                1111:1111:2222::/48;
            }
            locator myloc2 {
                2222:2222:2222::/48;
                micro-sid;
            }
 
        }
    }
    resolution {
        preserve-nexthop-hierarchy;
    }
}
interfaces {
    ae10 {
        unit 100 {
            encapsulation vlan-ccc;
            vlan-id 100;
        }
    }
    ae10 {
        unit 101 {
            encapsulation vlan-ccc;
            vlan-id 101;
        }
    }
}
routing-instances {
    vpws100 {
        instance-type evpn-vpws;
        protocols {
            evpn {
                interface ae10.100 {
                    vpws-service-id {
                        local 1;
                        remote 2;
                        source-packet-routing {
                            srv6 locator myloc1 end-dx2-sid 1111:1111:2222:100::;
                        }
                    }
                }
                encapsulation srv6;
            }
        }
        interface ae10.100;
        route-distinguisher 1.1.0.2:100;
        vrf-target target:65100:100;
    }
    vpws101 {
        instance-type evpn-vpws;
        protocols {
            evpn {
                interface ae10.101 {
                    vpws-service-id {
                        local 1;
                        remote 2;
                        source-packet-routing {
                            srv6 locator myloc1;
                        }
                    }
                }
                encapsulation srv6;
            }
        }
        interface ae10.101;
        route-distinguisher 1.1.0.2:101;
        vrf-target target:65100:101;
    }
}
policy-options {  
    policy-statement vpws-nh-change {
        term 1 {
            from {
                protocol evpn;
            }
            then {
                next-hop 1111:1111:2222::;
                accept;
            }
        }
    }
}
protocols {
    bgp {
        group INTERNALv6 {
            export vpws-nh-change;
            vpn-apply-export;
        }
    }
}
